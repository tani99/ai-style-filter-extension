<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Style Dashboard - Virtual Try-On Extension</title>
    <link rel="stylesheet" href="tab.css">
    <link rel="stylesheet" href="../gemini/gemini-styles.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üëï</span>
                    <h1>AI Style Dashboard</h1>
                </div>
                <p class="tagline">Discover your personal style with AI-powered analysis</p>
            </div>
        </header>

        <!-- Getting Started Section -->
        <section class="getting-started-section">
            <h2 style="text-align: center; margin-bottom: 30px; color: #374151; font-size: 24px;">Choose Your Path</h2>
            
            <div class="onboarding-options">
                <!-- Option 1: Upload Photos -->
                <div class="onboarding-card" id="uploadPhotoCard">
                    <div class="card-icon">üì∏</div>
                    <h3>Upload Photos</h3>
                    <p>Upload up to 5 images of yourself for AI-powered style recommendations</p>
                    <ul class="feature-list">
                        <li>‚ú® AI analyzes your features & coloring</li>
                        <li>üé® Discover colors that flatter you</li>
                        <li>üëó Get silhouettes for your body type</li>
                        <li>üõçÔ∏è Receive personalized style tips</li>
                    </ul>
                    <button class="option-btn" id="chooseUploadBtn">Get Started with Photos</button>
                </div>

                <!-- Option 2: Sign In to Wardrobe -->
                <div class="onboarding-card featured" id="wardrobeCard">
                    <div class="featured-badge">Recommended</div>
                    <div class="card-icon">üëö</div>
                    <h3>Fashion App Profile</h3>
                    <p>Sign in to your Fashion App profile to use your personal wardrobe</p>
                    <ul class="feature-list">
                        <li>üíæ Access your existing wardrobe</li>
                        <li>üîÑ Real-time sync with your app</li>
                        <li>‚ú® Get outfit suggestions while shopping</li>
                        <li>üéØ See what matches your closet</li>
                    </ul>
                    <button class="option-btn primary" id="chooseWardrobeBtn">Sign In to Wardrobe</button>
                </div>
            </div>
        </section>

        <!-- Main Content (Hidden until option selected) -->
        <main class="main-content" id="mainContent" style="display: none;">
            <!-- Photo Upload Section -->
            <section class="upload-section">
                <div class="section-header-with-back">
                    <button class="back-btn" id="backToOptionsBtn">‚Üê Back to Options</button>
                    <div>
                        <h2>Upload Your Photos</h2>
                        <p>Upload 3-5 clear photos of yourself so AI can analyze your features and recommend what would look best on you</p>
                    </div>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-placeholder">
                        <span class="upload-icon">üì∏</span>
                        <p>Click to upload photos or drag & drop here</p>
                        <small>Max 5 photos, 5MB each (JPG, PNG, WebP)</small>
                    </div>
                    <input type="file" id="photoInput" multiple accept="image/jpeg,image/jpg,image/png,image/webp" style="display: none;">
                </div>
                
                <div class="photo-gallery" id="photoGallery">
                    <!-- Uploaded photos will appear here -->
                </div>
                
                <div class="photo-controls" style="margin-top: 15px;">
                    <button id="clearAllBtn" class="clear-btn" style="display: none;">Clear All Photos</button>
                    <button id="clearProfileBtn" class="clear-btn" style="display: none; margin-left: 10px;">Clear Style Profile</button>
                </div>
            </section>

            <!-- Style Analysis Section -->
            <section class="analysis-section">
                <h2>Your Style Profile</h2>
                <div class="analysis-content" id="analysisContent">
                    <div class="placeholder-state">
                        <span class="placeholder-icon">üé®</span>
                        <p>Upload photos so AI can analyze your features and recommend what suits you best</p>
                        <button id="analyzeBtn" class="analyze-btn" disabled>
                            Analyze My Features
                        </button>
                    </div>
                </div>
            </section>

            <!-- Virtual Try-On Section -->
            <section class="tryon-section">
                <h2>Virtual Try-On (Gemini API)</h2>
                <div class="tryon-content">
                    <div class="gemini-status-item">
                        <label>
                            <span>Gemini API Status:</span>
                            <span id="geminiStatus" class="status-indicator">Checking...</span>
                        </label>
                    </div>

                    <div class="api-key-setup" id="apiKeySetup" style="display: none;">
                        <p class="setup-info">Enter your Gemini API key to enable virtual try-on features</p>
                        <div class="api-key-input-group">
                            <input type="password" id="geminiAPIKeyInput" placeholder="Enter Gemini API key...">
                            <button id="saveAPIKeyBtn" class="save-key-btn">Save API Key</button>
                            <button id="showAPIKeyBtn" class="toggle-visibility-btn">üëÅÔ∏è</button>
                        </div>
                        <p class="setup-help">
                            Get your free API key from <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>
                        </p>
                    </div>

                    <!-- Try-On Photo Upload Section -->
                    <div class="tryon-photo-section" id="tryonPhotoSection" style="display: none;">
                        <h3>Your Try-On Photo</h3>
                        <p>Upload a single photo of yourself that will be used for virtual try-on on shopping sites</p>

                        <div class="tryon-photo-upload-area" id="tryonPhotoUploadArea">
                            <div class="tryon-photo-placeholder" id="tryonPhotoPlaceholder">
                                <span class="upload-icon">üì∏</span>
                                <p>Click to upload your try-on photo</p>
                                <small>JPG, PNG, WebP (Max 5MB)</small>
                            </div>
                            <input type="file" id="tryonPhotoInput" accept="image/jpeg,image/jpg,image/png,image/webp" style="display: none;">
                        </div>

                        <div class="tryon-photo-preview" id="tryonPhotoPreview" style="display: none;">
                            <img id="tryonPhotoImage" alt="Your try-on photo" />
                            <button id="removeTryonPhotoBtn" class="remove-tryon-photo-btn">Remove Photo</button>
                        </div>
                    </div>

                    <div class="tryon-test" id="tryonTestSection" style="display: none;">
                        <h3>Test Virtual Try-On</h3>
                        <p>Upload a clothing image to test how it would look on you</p>
                        <div class="tryon-test-inputs">
                            <div class="tryon-input-item">
                                <label>Select your photo:</label>
                                <select id="userPhotoSelect">
                                    <option value="">Select a photo...</option>
                                </select>
                            </div>
                            <div class="tryon-input-item">
                                <label>Upload clothing image:</label>
                                <input type="file" id="clothingImageInput" accept="image/*">
                            </div>
                            <button id="testTryOnBtn" class="test-tryon-btn" disabled>Generate Try-On Image</button>
                        </div>
                        <div id="tryonResult" class="tryon-result" style="display: none;"></div>
                    </div>
                </div>
            </section>

            <!--Settings Section moved to the bottom -->
        </main>

        <!-- Wardrobe Section (Separate, shown when choosing wardrobe path) -->
        <section class="wardrobe-full-section" id="wardrobeSection" style="display: none;">
            <div class="section-header-with-back">
                <button class="back-btn" id="backFromWardrobeBtn">‚Üê Back to Options</button>
                <div>
                    <h2>Fashion App Wardrobe</h2>
                    <p>Connect and manage your personal wardrobe</p>
                </div>
            </div>

            <div class="wardrobe-content-wrapper">
                <!-- Login State -->
                <div id="wardrobeLogin" class="wardrobe-login">
                    <p class="intro-text">Login with your wardrobe account to enable outfit suggestions</p>

                    <div class="login-tabs">
                        <button id="loginTabBtn" class="tab-btn active">Login</button>
                        <button id="signupTabBtn" class="tab-btn">Sign Up</button>
                    </div>

                    <!-- Login Form -->
                    <div id="loginForm" class="auth-form">
                        <input type="email" id="loginEmail" placeholder="Email" autocomplete="email">
                        <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password">
                        <button id="loginBtn" class="auth-btn">Login</button>
                    </div>

                    <!-- Sign Up Form -->
                    <div id="signupForm" class="auth-form" style="display: none;">
                        <input type="text" id="signupName" placeholder="Display Name" autocomplete="name">
                        <input type="email" id="signupEmail" placeholder="Email" autocomplete="email">
                        <input type="password" id="signupPassword" placeholder="Password (min 6 characters)" autocomplete="new-password">
                        <button id="signupBtn" class="auth-btn">Create Account</button>
                    </div>

                    <div id="authError" class="error-message" style="display: none;"></div>
                </div>

                <!-- Connected State -->
                <div id="wardrobeConnected" class="wardrobe-connected" style="display: none;">
                    <div class="connected-header">
                        <div class="connected-info">
                            <span class="status-icon">‚úÖ</span>
                            <div class="user-info">
                                <span id="connectedUserName" class="user-name"></span>
                                <span id="connectedUserEmail" class="user-email"></span>
                            </div>
                        </div>
                        <button id="wardrobeLogoutBtn" class="logout-btn">Logout</button>
                    </div>

                    <!-- Photo Upload & Style Profile Section FIRST -->
                    <div class="wardrobe-photo-section" style="margin-top: 30px;">
                        <h3>üì∏ Upload Your Photos</h3>
                        <p class="intro-text">Upload 3-5 photos of yourself in different outfits for AI style analysis</p>
                        
                        <div class="upload-area" id="wardrobeUploadArea">
                            <div class="upload-placeholder">
                                <span class="upload-icon">üì∏</span>
                                <p>Click to upload photos or drag & drop here</p>
                                <small>Max 5 photos, 5MB each (JPG, PNG, WebP)</small>
                            </div>
                            <input type="file" id="wardrobePhotoInput" multiple accept="image/jpeg,image/jpg,image/png,image/webp" style="display: none;">
                        </div>
                        
                        <div class="photo-gallery" id="wardrobePhotoGallery">
                            <!-- Uploaded photos will appear here -->
                        </div>
                        
                        <div class="photo-controls" style="margin-top: 15px;">
                            <button id="wardrobeClearAllBtn" class="clear-btn" style="display: none;">Clear All Photos</button>
                            <button id="wardrobeClearProfileBtn" class="clear-btn" style="display: none; margin-left: 10px;">Clear Style Profile</button>
                        </div>
                    </div>

                    <!-- Style Analysis Section SECOND -->
                    <div class="wardrobe-analysis-section" style="margin-top: 30px;">
                        <h3>üé® Your Style Profile</h3>
                        <div class="wardrobe-analysis-content" id="wardrobeAnalysisContent">
                            <div class="placeholder-state">
                                <span class="placeholder-icon">üé®</span>
                                <p>Upload photos to generate your AI-powered style profile</p>
                                <button id="wardrobeAnalyzeBtn" class="analyze-btn" disabled>
                                    Analyze My Style
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Wardrobe Data at BOTTOM -->
                    <div class="wardrobe-data-section" style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #e5e7eb;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0;">üëö Your Wardrobe</h3>
                            <div class="wardrobe-actions">
                                <button id="refreshAnalysisBtn" class="refresh-analysis-btn">
                                    üîÑ Refresh AI Analysis
                                </button>
                            </div>
                        </div>

                        <div class="wardrobe-stats">
                            <div class="stat-card">
                                <span class="stat-value" id="itemCount">0</span>
                                <span class="stat-label">Items</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value" id="lookCount">0</span>
                                <span class="stat-label">Looks</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value sync-active" id="syncStatus">‚úÖ</span>
                                <span class="stat-label">Real-time Sync</span>
                            </div>
                        </div>

                        <div class="wardrobe-preview">
                            <h3>Recent Items</h3>
                            <div id="recentItemsGrid" class="items-grid">
                                <!-- Recent items will be displayed here -->
                            </div>
                        </div>

                        <div id="analysisProgress" class="analysis-progress" style="display: none;">
                            <div class="progress-content">
                                <div class="progress-spinner"></div>
                                <div class="progress-text">
                                    <strong id="progressTitle">Refreshing AI Analysis...</strong>
                                    <p id="progressMessage">Analyzing items...</p>
                                    <p id="progressCount" class="progress-count"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section class="settings-section" id="settingsSection" style="display: none;">
            <div class="section-header-with-back">
                <button class="back-btn" id="backFromSettingsBtn">‚Üê Back to Options</button>
                <h2>Settings</h2>
            </div>
            <div class="settings-content">
                <div class="setting-item">
                    <label>
                        <span>Chrome AI Status:</span>
                        <span id="aiStatus" class="status-indicator">Checking...</span>
                    </label>
                </div>
                <div class="setting-item">
                    <button id="testAIBtn" class="test-ai-btn">Test Chrome AI</button>
                    <div id="aiTestResult" class="ai-test-result" style="display: none;"></div>
                </div>
                <div class="setting-item">
                    <button id="testFirebaseBtn" class="test-firebase-btn">Test Firebase Connection</button>
                    <div id="firebaseTestResult" class="firebase-test-result" style="display: none;"></div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by Chrome Built-in AI & Gemini Developer API</p>
        </footer>
    </div>

    <!-- HEIC support temporarily disabled -->
    <!-- <script src="../lib/heic2any.min.js"></script> -->

    <!-- Gemini API UI Module (Virtual Try-On) -->
    <script src="../gemini/gemini-ui.js"></script>

    <!-- Main Tab Script -->
    <script src="tab.js"></script>

    <!-- Wardrobe Authentication Module -->
    <script src="tab-wardrobe.js"></script>
</body>
</html>